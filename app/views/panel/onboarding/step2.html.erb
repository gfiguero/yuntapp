<div class="w-full">
  <h1 class="font-bold text-4xl my-4"><%= I18n.t('onboarding.title') %></h1>
  <p class="text-base-content/60 mb-4"><%= I18n.t('onboarding.subtitle') %></p>

  <%= render "steps", current_step: 2 %>

  <h2 class="font-bold text-2xl mb-2"><%= I18n.t('onboarding.step2.title') %></h2>
  <p class="text-base-content/60 mb-6"><%= I18n.t('onboarding.step2.description') %></p>

  <% if current_user.verified_identity %>
    <div class="alert alert-info mb-4">
      <%= icon("check-circle", class: "w-6 h-6") %>
      <span>Ya tienes una identidad verificada. Por favor, confirma tus datos para esta nueva solicitud.</span>
    </div>
  <% end %>

  <% 
    # Helper para determinar clase de validación
    def input_class(model, attribute)
      # Si hay errores en este atributo, siempre es rojo
      return "input-error" if model.errors.include?(attribute)
      
      # Si tiene valor y no tiene errores, PODRÍA ser verde, pero debemos tener cuidado.
      # En este caso, asumimos que si llega aquí desde el servidor, es el estado "final" validado.
      return "input-success" if model.send(attribute).present? && !model.errors.include?(attribute)
      ""
    end
  %>

  <%# Contenedor principal sin form global para los campos individuales %>
  <div class="grid gap-4 w-full max-w-md">
    
    <%# CAMPO: First Name %>
    <%= render "step2_field_first_name", identity_request: @identity_request %>

    <%# CAMPO: Last Name %>
    <%= render "step2_field_last_name", identity_request: @identity_request %>

    <%# CAMPO: RUN %>
    <%= render "step2_field_run", identity_request: @identity_request %>

    <%# CAMPO: Phone %>
    <%= render "step2_field_phone", identity_request: @identity_request %>

    <%# CAMPO: Identity Document (Multiple) %>
    <%= render "step2_field_identity_documents", identity_request: @identity_request %>

  </div>

  <%# Botones de navegación (Formulario separado para el submit final) %>
  <div class="mt-6 flex gap-2">
    <%= link_to I18n.t('actions.back'), panel_onboarding_step1_path, class: "btn btn-soft", data: { turbo_frame: "_top" } %>
    
    <%= render "step2_submit_button", identity_request: @identity_request %>
  </div>
</div>
