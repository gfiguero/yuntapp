<div class="w-full">
  <h1 class="font-bold text-4xl my-4"><%= I18n.t('panel.onboarding.title') %></h1>
  <p class="text-base-content/60 mb-4"><%= I18n.t('panel.onboarding.subtitle') %></p>

  <%= render "steps", current_step: 3 %>

  <h2 class="font-bold text-2xl mb-2"><%= I18n.t('panel.onboarding.step3.title') %></h2>
  <p class="text-base-content/60 mb-2"><%= I18n.t('panel.onboarding.step3.description') %></p>

  <div class="alert alert-info mb-4">
    <p><strong><%= I18n.t('panel.onboarding.steps.neighborhood') %>:</strong> <%= @neighborhood_association.name %>
      <% if @neighborhood_association.commune %>
        &mdash; <%= @neighborhood_association.commune.name %>
      <% end %>
    </p>
  </div>

  <% 
    # Helper para determinar clase de validación (igual que step2)
    def input_class(model, attribute)
      return "input-error" if model.errors.include?(attribute)
      return "input-success" if model.send(attribute).present? && !model.errors.include?(attribute)
      ""
    end
  %>

  <%# Contenedor principal sin form global %>
  <div class="grid gap-4 w-full max-w-md">
    
    <%# CAMPO: Delegación / Calle Manual %>
    <%= render "step3_field_delegation_address", residence_request: @residence_request, delegations: @delegations %>

    <%# CAMPO: Número %>
    <%= render "step3_field_number", residence_request: @residence_request %>

    <%# CAMPO: Detalle (Address Line 2) %>
    <%= render "step3_field_address_line_2", residence_request: @residence_request %>

  </div>

  <%# Botones de navegación %>
  <div class="mt-6 flex gap-2">
    <%= link_to I18n.t('actions.back'), panel_onboarding_step2_path, class: "btn btn-soft", data: { turbo_frame: "_top" } %>
    
    <%= render "step3_submit_button", residence_request: @residence_request %>
  </div>
</div>
